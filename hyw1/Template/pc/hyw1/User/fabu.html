<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>好运旺租叉车</title>
<link href="__PUBLIC__/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/Public/hyw/css/base.css" rel="stylesheet" type="text/css" />
<link href="/Public/hyw/css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/Public/hyw/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript">
  $(function() {    
    $("#file0").change(function() {
      if (this.files && this.files[0]) {
        var objUrl = getObjectURL(this.files[0]);
        console.log("objUrl = " + objUrl);
        if (objUrl) {
          $("#img0").attr("src", objUrl);
          $("#file0").click(function(e) {
            $("#img0").attr("src", objUrl);
          });
        } else {
          //IE下，使用滤镜
          this.select();
          var imgSrc = document.selection.createRange().text;
          var localImagId = document.getElementById("sss");
          //图片异常的捕捉，防止用户修改后缀来伪造图片
          try {
            preload.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = data;
          } catch (e) {
            this._error("filter error");
            return;
          }
          this.img.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src=\"" + data + "\")";
        }
      }
    });
    $("#file1").change(function() {
      if (this.files && this.files[0]) {
        var objUrl = getObjectURL(this.files[0]);
        console.log("objUrl = " + objUrl);
        if (objUrl) {
          $("#img1").attr("src", objUrl);
          $("#file1").click(function(e) {
            $("#img1").attr("src", objUrl);
          });
        } else {
          //IE下，使用滤镜
          this.select();
          var imgSrc = document.selection.createRange().text;
          var localImagId = document.getElementById("sss");
          //图片异常的捕捉，防止用户修改后缀来伪造图片
          try {
            preload.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = data;
          } catch (e) {
            this._error("filter error");
            return;
          }
          this.img.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src=\"" + data + "\")";
        }
      }
    });    
    //建立一個可存取到該file的url
    function getObjectURL(file) {
      var url = null;
      if (window.createObjectURL != undefined) { // basic
        url = window.createObjectURL(file);
      } else if (window.URL != undefined) { // mozilla(firefox)
        url = window.URL.createObjectURL(file);
      } else if (window.webkitURL != undefined) { // webkit or chrome
        url = window.webkitURL.createObjectURL(file);
      }
      return url;
    }
  })
</script>  
</head>


<body>
<!--------头部开始-------------->
<include file="Public/header" />
<!--------头部结束-------------->
<!--------位置与搜索开始-------------->
<include file="Public/userTop" />
<!--------位置与搜索结束-------------->
<div class="neiCent2">
  <div class="mayLeft">  
    <!--------左边导航开始-------------->
    <include file="Public/userLeft" />
    <!--------左边导航结束-------------->
  </div>

  <div class="mayRight">
    <div class="rigbiaot" style='width:803px'>我的求职</div>
    <div class="mayxiax">
      <form action="" id='resume' method="post">
       <div class="xingm">
         <div class="qiuname">姓名：</div>
         <div class="qiukuan"><input value="{$Resume.user_name}" name="user_name" type="text" class="qiuk2"/></div>
         <div class="clear"></div>
       </div>
       <div class="gernam1">
         <div class="mingc">性别:</div>
         <div class="mingkuan">
          <div class="gzyeaSe1"> 
       <input class="magic-radio" type="radio" name="sex" id="r8" value="1" checked>
       <label for="r8" class="zhiwenz"> 男</label> 
     </div>
     <div class="gzyeaSe1"> 
       <input class="magic-radio" type="radio" name="sex" id="r9" value="2">
       <label for="r9" class="zhiwenz"> 女</label> 
     </div>
     <div class="clear"></div>
         </div>
         <div class="clear"></div>
       </div>
       
       <div class="xingm">
         <div class="qiuname">年龄：</div>
         <div class="qiukuan"><input name="age" value="{$Resume.age}" type="number" class="qiuk2"/></div>
         <div class="clear"></div>
       </div>
       <script>
       $('input[name="age"]').change(function(){
        if($(this).val() < 1){
          $(this).val(1);
        }
       })
       </script>
<!--        <div class="xingm">
         <div class="qiuname">学历：</div>
         <div class="qiukuan">
            <select name="xueli">
              <foreach item='xueli' name='xueli'>
                <option value="{$xueli}">{$xueli}</option>
              </foreach>
            </select>
         </div>
         <div class="clear"></div>
       </div>
       <div class="xingm">
         <div class="qiuname">经验：</div>
         <div class="qiukuan">
            <select name="jingyan">
              <foreach item='jingyan' name='jingyan' key='key'>
                <option value="{$key}">{$jingyan}</option>
              </foreach>
            </select>
          </div>
         <div class="clear"></div>
       </div> -->              
       <div class="xingm">
         <div class="qiuname">电话：</div>
         <div class="qiukuan"><input value="{$Resume.mobile}" name="mobile" type="number" class="qiuk2"/></div>
         <div class="clear"></div>
       </div>
      <div class="xingm">
         <div class="qiuname">经验：</div>
         <div class='col-xs-6'  style='padding-left:0'>
            <select name='jingyan' class="form-control">
                <option value="1">1年</option>
                <option value="2">2年</option>
                <option value="3">3年</option>
                <option value="4">4年</option>
                <option value="5+">5年以上</option>
                <option value="10+">10年以上</option>
            </select>
            </div>
       </div>    
       <div class="xingm">
         <div class="qiuname">学历：</div>
         <div class='col-xs-6' style='padding-left:0'>
            <select name='xueli'  class="form-control">
                <option value="小学">小学</option>
                <option value="初中">初中</option>
                <option value="高中">高中</option>
                <option value="中专">中专</option>
                <option value="专科">专科</option>
                <option value="本科">本科</option>
                <option value="硕士">硕士</option>
                <option value="博士">博士</option>
            </select>
            </div>
         <div class="clear"></div>
       </div>                  
       <div class="xingm">
         <div class="qiuname">地址：</div>
         <div>
          <div class='col-xs-3' style='padding:0'>
            <select name='province' class="form-control" onchange="get_city(this)" id="province">
                <option value="0">选择省份</option>
            </select>
            </div>
            <div class='col-xs-3'>
            <select name='city' class="form-control" onchange="get_area(this)" id="city" name="city">
                <option value="0">选择城市</option>
            </select>
            </div>
         </div>
         <div class="clear"></div>
       </div>
<!--        <div class="xingm">
         <div class="qiuname">叉车证：</div>
        <div class="mingkuan">
          <div class="chuantu"><a href="#">上传图片</a></div>
         </div>
         <div class="clear"></div>
       </div> -->
       <div class="gernam1">
         <div class="qiuname">叉车证: </div>
         <!-- <div class="mingkuan" style='height:200px'> -->
          <!-- <div class="chuantu"><a href="#">上传图片</a></div> -->
         <!-- </div> -->
         <div class="miankun" style='height:170px;margin-left:0'>
            <div class="upload">
              <div id="sss">
              <img class="acc_imgin" style='width:242px;height:159px' src="{$Resume.thumb|default='/Public/hyw/images/zhc-dit.gif'}"  id="img0" />
              </div>
            </div>
            <div class="upBtn"><a href="#"  class="tc acc_scicon">上传</a>
             <input type="file" name="thumb" id="file0" multiple class="ph08" />
            </div>
            <div class="clear"></div>
          </div>
         <div class="clear"></div>
       </div>       
       <div class="xiugai" style='width:803px'>
        <input name="" type="button" class="fabbtn" value="发布简历"/> 
        &nbsp;&nbsp;&nbsp;&nbsp;<span name='tishi'></span>
       </div>
        <a style='float:right;margin-right:80px' href="{:U('User/resume')}">返回</a>
      </form>
    </div>
  </div>
    
  <div class="clear"></div>
</div>
<!--------尾部开始-------------->
<include file="Public/footer" />
<!--------尾部结束--------------> 
</body>
<script>
$('input[type="button"]').click(function(){
      var obj = $(this);
      // obj.attr({'disabled':'disabled'});
      var formData = new FormData($( "#resume" )[0]);
      $.ajax({
            type : "POST",
            url:"{:U('User/publishResume')}",
            // data : $('#resume').serialize(),// 你的formid
            data:formData,
            dataType:'json',
            contentType: false,
            processData: false,
            success: function(date){
                obj.attr({'disabled':false});
                if(date['status']==-2){
                  window.location.href = "{:U('Login/login')}";
                  return false;
                }else{
                  if(date['status']==1){
                    $('span[name="tishi"]').css({'color':'green'});
                  }else if(date['status']==-1){
                    $('span[name="tishi"]').css({'color':'red'});
                  }
                  $('span[name="tishi"]').html('');
                  $('span[name="tishi"]').append(date['msg']);
                }
            }
          });
});
get_city1();

var istype = 4;
function get_city1(obj)
{
    $.post(
        '{:U("News/get_city")}',
        {type:4},
        function(data){
            var str = '<option value="0">选择省份</option>';
            $.each(data['list'],function(key,val){
                if(isContains(val.name,data.address.province)){
                  str += '<option selected value="'+val['id']+'">'+val['name']+'</option>';
                  var id = val.id;
                }else{
                  str += '<option value="'+val['id']+'">'+val['name']+'</option>';
                }
            });
            $('#province').html('');
            $('#province').append(str);
            if(istype == 4){
              get_city(1);
              istype = 5;
            }
        },
        'json'
    );
    // console.log(id);
}

function get_city(obj)
{ 
    var id;

    if(typeof(obj) == 'object'){
      id = $(obj).val();
    }else{
      id = $('#province').val();
      // id = obj;
    }
    console.log(obj);
    $.post(
        '{:U("News/get_city")}',
        {id:id,type:4}, 
        function(data){
            var str = '<option value="0">选择城市</option>';
            $.each(data['list'],function(key,val){
                if(isContains(val.name,data.address.city)){
                  str += '<option selected value="'+val['id']+'">'+val['name']+'</option>';
                }else{
                  str += '<option value="'+val['id']+'">'+val['name']+'</option>';
                }
            });
            $('#city').html('');
            $('#city').append(str);
        },
        'json'
    )
}

function isContains(str, substr) {
    return new RegExp(substr).test(str);
}
</script>
</html>
